#!/usr/bin/octave-cli
script_path = fileparts(mfilename('fullpath'));
script_path = strcat(script_path, "/../..");
addpath(genpath(script_path));


% Settings
calib_data_dir = "/data/euroc_mav/cam_april/";
aprilgrid_file = "/tmp/calib/mono/1404733405732800000.csv";

% Load calibration data
data = load_euroc(calib_data_dir);

# T_WM = {};
# for i = 1:data.marker0.nb_measurements
#   C_WM = quat2rot(data.marker0.q_RS_S{i});
#   r_WM = data.marker0.p_RS_S{i};
#   T_WM{i} = tf(C_WM, r_WM);
# end

% Load aprilgrid data
aprilgrid = load_aprilgrid(aprilgrid_file);
T_CF = aprilgrid.T_CF;
hp_CF = [aprilgrid.points_CF; ones(1, columns(aprilgrid.points_CF))];
points_C = inv(T_CF) * hp_CF;

figure(1);
hold on;
# draw_frame(T_WM{i});         % Marker frame
draw_frame(inv(T_CF));  % Camera frame
# draw_points(points_C);
xlabel("x");
ylabel("y");
zlabel("z");
axis("equal");
xlim([-2.0, 2.0]);
ylim([-2.0, 2.0]);
zlim([-2.0, 2.0]);
view(3);
ginput();

# points_W

# % Plot
# for i = 1:10:data.marker0.nb_measurements
#   % Show camera image
#   figure(1);
#   hold on;
#   clf;
#   imshow(data.cam0.image_paths{i})
#
#   % Show frames and AprilGrid
#   figure(2);
#   clf;
#   hold on;
#   draw_frame(T_CF);  % Camera frame
#   draw_points(points_W);
#   view(3);
#   axis("equal");
#   xlabel("x");
#   ylabel("y");
#   zlabel("z");
#   ginput();
# end
